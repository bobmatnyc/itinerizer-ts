---
timestamp: 2025-12-18T04:26:03.577418+00:00
type: agent_engineer
metadata: {"agent_type": "engineer", "agent_id": "engineer_bc691194-b92e-4217-8fbe-378faa708438", "session_id": "bc691194-b92e-4217-8fbe-378faa708438", "delegation_context": {"description": "Create Travel Agent service", "timestamp": "2025-12-18T04:26:03.576411+00:00"}}
---


AGENT MEMORY - PROJECT-SPECIFIC KNOWLEDGE:
# Agent Memory: engineer
<!-- Last Updated: 2025-12-17T23:24:44.617242+00:00Z -->



INSTRUCTIONS: Review your memory above before proceeding. Apply learned patterns and avoid known mistakes.


Create a Travel Agent service for itinerizer-ts that uses SerpAPI to intelligently find real travel options to fill missing segments.

## Configuration

1. Add SerpAPI key to the YAML config at `.itinerizer/config.yaml`:
```yaml
serpapi:
  apiKey: f9938a71cfce0d2f0d07fdac6ead0d8ea73e451b0795b1c4b11c387394c97643
```

2. Update `src/domain/types/import.ts` to add SerpAPI config interface:
```typescript
export interface SerpApiConfig {
  apiKey: string;
}

export interface ImportConfig {
  // ... existing fields
  serpapi?: SerpApiConfig;
}
```

3. Update `src/storage/yaml-config.ts` to load SerpAPI config

## Travel Agent Service

Create `src/services/travel-agent.service.ts` with these capabilities:

### 1. Class Inference
- Analyze existing trip segments to determine travel class preference:
  - Look at existing flights for cabin class (ECONOMY, PREMIUM_ECONOMY, BUSINESS, FIRST)
  - Look at hotels for star rating/brand tier
  - Default to ECONOMY if no evidence

### 2. Flight Search
- Use SerpAPI Google Flights endpoint
- Search for flights matching:
  - Origin/destination from gap locations (use IATA codes if available)
  - Dates from gap timing
  - Inferred class preference
- Return best matching flight with:
  - Airline, flight number
  - Actual departure/arrival times
  - Price estimate

### 3. Hotel Search  
- Use SerpAPI Google Hotels endpoint
- Search for accommodations matching:
  - Location from segment
  - Check-in/check-out dates
  - Star rating based on inferred class
- Return best matching hotel with:
  - Hotel name, address
  - Star rating, price
  - Check-in/check-out times

### 4. Ground Transportation Search
- Use SerpAPI for local search of:
  - Car rentals
  - Shuttle services
  - Bus/train routes
- Match location and timing from gaps

### Service Interface

```typescript
export interface TravelSearchResult {
  found: boolean;
  segment?: Segment;  // Ready-to-use segment if found
  searchQuery?: string;  // What was searched
  alternatives?: Array<{
    description: string;
    price?: number;
    url?: string;
  }>;
}

export class TravelAgentService {
  constructor(config: SerpApiConfig);
  
  // Analyze trip to infer preferences
  inferTravelClass(segments: Segment[]): TravelClass;
  inferHotelTier(segments: Segment[]): number; // 1-5 stars
  
  // Search for specific gap fillers
  searchFlight(gap: LocationGap, preferences: TravelPreferences): Promise<TravelSearchResult>;
  searchHotel(location: Location, dates: DateRange, preferences: TravelPreferences): Promise<TravelSearchResult>;
  searchTransfer(gap: LocationGap, preferences: TravelPreferences): Promise<TravelSearchResult>;
  
  // Main method - intelligently fill a gap
  fillGapIntelligently(gap: LocationGap, existingSegments: Segment[]): Promise<TravelSearchResult>;
}
```

### Integration with DocumentImportService

Update `src/services/document-import.service.ts`:
1. If SerpAPI is configured, use TravelAgentService instead of creating empty placeholders
2. Fall back to placeholder creation if:
   - SerpAPI not configured
   - Search returns no results
   - API errors

### SerpAPI Endpoints to Use

1. **Google Flights**: `https://serpapi.com/search?engine=google_flights`
   - Parameters: departure_id, arrival_id, outbound_date, type=1 (one-way)
   
2. **Google Hotels**: `https://serpapi.com/search?engine=google_hotels`
   - Parameters: q (location), check_in_date, check_out_date
   
3. **Google Maps Local**: `https://serpapi.com/search?engine=google_maps`
   - For car rentals, shuttles, etc.

### Error Handling
- Rate limit handling with retry
- Graceful degradation to placeholder segments
- Log all API calls and costs

### Testing
Create tests at `tests/services/travel-agent.service.test.ts`:
- Test class inference from existing segments
- Mock SerpAPI responses for flight/hotel/transfer searches
- Test fallback to placeholders

Write the complete implementation with proper TypeScript types and error handling.