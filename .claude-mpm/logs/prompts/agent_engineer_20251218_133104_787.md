---
timestamp: 2025-12-18T13:31:04.787981+00:00
type: agent_engineer
metadata: {"agent_type": "engineer", "agent_id": "engineer_bc691194-b92e-4217-8fbe-378faa708438", "session_id": "bc691194-b92e-4217-8fbe-378faa708438", "delegation_context": {"description": "Add model selector and Vite viewer", "timestamp": "2025-12-18T13:31:04.784350+00:00"}}
---


AGENT MEMORY - PROJECT-SPECIFIC KNOWLEDGE:
# Agent Memory: engineer
<!-- Last Updated: 2025-12-17T23:24:44.617242+00:00Z -->



INSTRUCTIONS: Review your memory above before proceeding. Apply learned patterns and avoid known mistakes.


Implement two features for itinerizer-ts:

## 1. Dynamic Model Selection Based on File Size

Create `src/services/model-selector.service.ts`:

```typescript
export interface ModelConfig {
  name: string;
  maxTokens: number;
  costPerMillionInput: number;
  costPerMillionOutput: number;
  maxRecommendedFileSize: number; // in bytes
}

export const AVAILABLE_MODELS: ModelConfig[] = [
  {
    name: 'anthropic/claude-3-haiku',
    maxTokens: 8192,
    costPerMillionInput: 0.25,
    costPerMillionOutput: 1.25,
    maxRecommendedFileSize: 500_000, // 500KB
  },
  {
    name: 'anthropic/claude-3.5-sonnet',
    maxTokens: 16384,
    costPerMillionInput: 3.0,
    costPerMillionOutput: 15.0,
    maxRecommendedFileSize: 2_000_000, // 2MB
  },
  {
    name: 'anthropic/claude-3-opus',
    maxTokens: 32768,
    costPerMillionInput: 15.0,
    costPerMillionOutput: 75.0,
    maxRecommendedFileSize: 10_000_000, // 10MB
  },
];

export class ModelSelectorService {
  // Select best model based on file size
  selectModelForFile(filePath: string): ModelConfig;
  
  // Get model by name
  getModel(name: string): ModelConfig | undefined;
  
  // Estimate cost for a file
  estimateCost(filePath: string, model?: string): { model: string; estimatedCost: number };
}
```

Update `src/services/document-import.service.ts` to:
- Use ModelSelectorService to auto-select model if not specified
- Log which model was selected and why

Update `src/services/llm.service.ts` to:
- Use model-specific maxTokens from config
- Support the higher token limits for larger models

## 2. Vite Web Viewer Server

Create a new `viewer/` directory with Vite + React:

```
viewer/
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ index.html
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ItineraryList.tsx
â”‚   â”‚   â”œâ”€â”€ ItineraryDetail.tsx
â”‚   â”‚   â”œâ”€â”€ SegmentCard.tsx
â”‚   â”‚   â”œâ”€â”€ GapIndicator.tsx
â”‚   â”‚   â””â”€â”€ TripProfile.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useItineraries.ts
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ index.css
```

**Features:**
- List all imported itineraries from `data/itineraries/`
- Show segment timeline with source indicators (ðŸ“„ import / ðŸ¤– agent)
- Display gap detection results visually
- Show trip profile inference
- Color-code by segment type (flights=blue, hotels=purple, transfers=orange, activities=green)

**API Server:**
Create `src/server/api.ts` with Express endpoints:
- `GET /api/itineraries` - List all
- `GET /api/itineraries/:id` - Get one with full details
- `POST /api/import` - Import a new PDF (multipart form)
- `GET /api/models` - List available models

**Integration:**
- Add `npm run viewer` script to start both API and Vite dev server
- Add `npm run viewer:build` for production build

**package.json scripts:**
```json
{
  "scripts": {
    "viewer": "concurrently \"npm run server\" \"npm run viewer:dev\"",
    "viewer:dev": "cd viewer && npm run dev",
    "viewer:build": "cd viewer && npm run build",
    "server": "tsx src/server/index.ts"
  }
}
```

Install dependencies:
- `npm install express cors multer`
- `npm install -D @types/express @types/cors @types/multer concurrently`

In viewer/:
- `npm create vite@latest . -- --template react-ts`
- `npm install @tanstack/react-query axios lucide-react`
- Use Tailwind CSS for styling

Make sure everything builds and runs correctly.