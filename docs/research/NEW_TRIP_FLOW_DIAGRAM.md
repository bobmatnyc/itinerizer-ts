# New Trip Creation Flow

## Visual Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HOME VIEW                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Welcome back!                                            â”‚  â”‚
â”‚  â”‚  Ready to plan your next adventure?                      â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  Quick Prompts:                                          â”‚  â”‚
â”‚  â”‚  [Plan a weekend getaway]  [Help with upcoming trip]    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ User clicks "Create New"
                            â”‚ or Quick Prompt
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               NEW TRIP HELPER VIEW (EMPTY)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ’¬ CHAT PANEL   â”‚  â”‚  âœˆï¸ Let's Plan Your Trip!         â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚ AI: Who's       â”‚  â”‚  What We'll Cover:                 â”‚  â”‚
â”‚  â”‚ traveling?      â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚ ğŸ“ Destination               â”‚   â”‚  â”‚
â”‚  â”‚ [Solo]          â”‚  â”‚  â”‚ ğŸ“… Dates                     â”‚   â”‚  â”‚
â”‚  â”‚ [Couple]        â”‚  â”‚  â”‚ ğŸ‘¥ Who's traveling           â”‚   â”‚  â”‚
â”‚  â”‚ [Family]        â”‚  â”‚  â”‚ ğŸ’° Budget & style            â”‚   â”‚  â”‚
â”‚  â”‚ [Friends]       â”‚  â”‚  â”‚ â­ Interests & activities    â”‚   â”‚  â”‚
â”‚  â”‚ [Business] ğŸ’¼   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚ [Other]         â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  ğŸ’¡ Tip: Answer in chat or use      â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚     quick-select options           â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  ğŸ‘ˆ Ready? Check the chat panel!   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ User answers questions
                            â”‚ AI asks follow-up questions
                            â”‚ Helper view stays visible
                            â–¼
                    (Questions continue...)
                            â”‚
                            â”‚ AI adds first segment
                            â”‚ (Flight/Hotel/Activity)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ITINERARY DETAIL VIEW (AUTO-SWITCH)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ’¬ CHAT PANEL   â”‚  â”‚  ğŸ“‹ Portugal Trip - Jan 5-19        â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚ AI: I've added  â”‚  â”‚  ğŸ“… Day 1 - January 5              â”‚  â”‚
â”‚  â”‚ your flight!    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚ âœˆï¸ Flight SFO â†’ LIS         â”‚   â”‚  â”‚
â”‚  â”‚ User: Great!    â”‚  â”‚  â”‚    9:45 AM - 5:30 PM        â”‚   â”‚  â”‚
â”‚  â”‚ What hotels do  â”‚  â”‚  â”‚    United Airlines          â”‚   â”‚  â”‚
â”‚  â”‚ you recommend?  â”‚  â”‚  â”‚    $650                     â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚ AI: I found 3   â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚ great options.. â”‚  â”‚  ğŸ“… Day 2 - January 6              â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚ ğŸ¨ Hotel Lisbon Heritage    â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚    Check-in 3:00 PM         â”‚   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Transitions

### Trigger Points

1. **Create New Itinerary**
   ```
   Home â†’ New Trip Helper
   ```

2. **Quick Prompt Clicked**
   ```
   Home â†’ New Trip Helper (if no itinerary)
   Home â†’ Detail View (if itinerary has segments)
   ```

3. **First Segment Added**
   ```
   New Trip Helper â†’ Itinerary Detail (automatic)
   ```

4. **All Segments Deleted**
   ```
   Itinerary Detail â†’ New Trip Helper (automatic)
   ```

## Component Responsibilities

### NewTripHelperView.svelte
- **Purpose**: Guide users through trip creation process
- **Displayed**: When itinerary is selected but has 0 segments
- **Content**:
  - Welcoming header with animated plane icon âœˆï¸
  - Visual checklist of information to collect
  - Helpful tips about using chat
  - Animated pointer directing to chat panel
- **Transitions**: Friendly animations (float, pulse, point)

### +page.svelte (Main Container)
- **Purpose**: Orchestrate view switching
- **Reactive Logic**:
  ```typescript
  // Effect 1: Home â†’ Helper/Detail based on segments
  if (onHomeView && hasItinerary && hasActivity) {
    view = hasSegments ? 'detail' : 'helper';
  }

  // Effect 2: Helper â†’ Detail when segments added
  if (onHelperView && hasSegments) {
    view = 'detail';
  }
  ```
- **Triggers**:
  - `$selectedItinerary` changes (store update)
  - `$chatMessages` changes (user interaction)
  - `$isStreaming` changes (AI responding)

## Traveler Options (NEW)

When AI asks "Who's traveling?", options now include:

```
Solo      â†’ Just me
Couple    â†’ Traveling with partner
Family    â†’ With kids
Friends   â†’ Group of adults
Business  â†’ Work travel ğŸ’¼ (NEW!)
Other     â†’ I'll describe my group
```

The Business option enables AI to:
- Suggest hotels near business districts
- Recommend co-working spaces
- Find quick dining options
- Account for work schedules
- Suggest networking venues

## Key Benefits

âœ… **Contextual Guidance**: Users always see relevant content
âœ… **Seamless Transitions**: Automatic view switching feels natural
âœ… **Visual Feedback**: Animations keep interface engaging
âœ… **Clear Expectations**: Helper view explains what's coming
âœ… **Progressive Disclosure**: Information revealed as needed
âœ… **Business Travel Support**: New option for work trips

## Technical Implementation

### Reactive Dependencies
```typescript
// Stores that trigger view updates
$selectedItinerary        // From itineraries.ts
$selectedItinerary.segments  // Reactive array
$chatMessages             // From chat.ts
$isStreaming             // From chat.ts
```

### View Selection Logic
```typescript
type MainView =
  | 'home'              // Initial landing
  | 'new-trip-helper'   // Empty itinerary guidance
  | 'itinerary-detail'  // Itinerary with segments
  | 'import'            // Import flow
  | 'help'              // Documentation
```

### Automatic Updates
When `addSegment()` is called (by AI or user):
1. API call updates backend
2. `selectedItinerary` store updates
3. Reactive `$effect` detects change
4. View switches to `itinerary-detail`
5. User sees new segment immediately

No manual intervention needed - it just works! âœ¨
